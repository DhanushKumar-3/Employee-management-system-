{% extends "employees/base.html" %}
{% block content %}
<div class="card-ems mb-3">
  <h3>Manager Dashboard{% if department %} - {{ department.name }}{% endif %}</h3>
  <div class="row mt-3">
    <div class="col-md-4">
      <div class="card-ems">
        <h6>Employees</h6>
        <h2>{{ employees|length }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card-ems">
        <h6>Attendance Records</h6>
        <h2>{{ attendance_count }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card-ems">
        <h6>Average Salary</h6>
        <h2>{{ avg_salary|floatformat:0 }}</h2>
      </div>
    </div>
  </div>
</div>

<div class="card-ems mb-3">
  <div class="d-flex justify-content-between align-items-center">
    <h5>Department Employees</h5>
    <a href="{% url 'manager_employee_create' %}" class="btn btn-sm btn-primary">Add Employee</a>
  </div>
  <table class="table table-dark table-striped table-sm align-middle">
    <thead><tr><th>Emp ID</th><th>Name</th><th>Actions</th></tr></thead>
    <tbody>
      {% for e in employees %}
      <tr>
        <td>{{ e.employee_id }}</td>
        <td>{{ e.user.get_full_name }}</td>
        <td>
          <a href="{% url 'mark_attendance' e.id %}" class="btn btn-sm btn-success">Attendance</a>
          <a href="{% url 'process_salary' e.id %}" class="btn btn-sm btn-info">Salary</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="3">No employees assigned.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="card-ems">
  <h5>Recent Leave Requests</h5>
  <table class="table table-dark table-striped table-sm align-middle">
    <thead><tr><th>Emp</th><th>Dates</th><th>Status</th><th>Action</th></tr></thead>
    <tbody>
      {% for l in leaves %}
      <tr>
        <td>{{ l.employee.employee_id }}</td>
        <td>{{ l.start_date }} â†’ {{ l.end_date }}</td>
        <td>{{ l.status }}</td>
        <td>
          {% if l.status == "Pending" %}
            <a href="{% url 'approve_leave' l.id %}?action=Approve" class="btn btn-sm btn-success">Approve</a>
            <a href="{% url 'approve_leave' l.id %}?action=Reject" class="btn btn-sm btn-danger">Reject</a>
          {% else %} - {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="4">No leave requests.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
